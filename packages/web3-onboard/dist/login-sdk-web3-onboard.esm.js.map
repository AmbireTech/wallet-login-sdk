{"version":3,"file":"login-sdk-web3-onboard.esm.js","sources":["../src/index.ts"],"sourcesContent":["import { AmbireLogoSVG, AmbireLoginSDK, sdkParamsType } from '@ambire/login-sdk-core'\nimport { createEIP1193Provider, WalletInit, TransactionObject } from '@web3-onboard/common'\n\nexport function AmbireWalletModule(sdkParams: sdkParamsType): WalletInit {\n    const ambireSDK = new AmbireLoginSDK(sdkParams)\n\n    let connectedAccounts: string[] = []\n    let connectedchain: string\n\n    const handleLogin = async (chainId: string|null = null) => {\n        chainId = chainId ?? connectedchain\n\n        ambireSDK.openLogin({chainId: parseInt(chainId)})\n\n        return new Promise((resolve, reject) => {\n            ambireSDK.onLoginSuccess((data: any) => {\n                connectedAccounts = [data.address]\n                connectedchain = `0x${parseInt(data.chainId).toString(16)}`\n                resolve(connectedAccounts)\n            })\n\n            ambireSDK.onAlreadyLoggedIn((data: any) => {\n                connectedAccounts = [data.address]\n                connectedchain = `0x${parseInt(data.chainId).toString(16)}`\n                resolve(connectedAccounts)\n            })\n\n            ambireSDK.onRegistrationSuccess((data: any) => {\n                connectedAccounts = [data.address]\n                connectedchain = `0x${parseInt(data.chainId).toString(16)}`\n                resolve(connectedAccounts)\n            })\n\n            ambireSDK.onActionRejected((data: any) => {\n                connectedAccounts = [data.address]\n                reject({ code: 4001, message: 'User rejected the request.' })\n            })\n        })\n    }\n\n    const handleSignMessage = async (signType: string, message: string) => {\n        ambireSDK.openSignMessage(signType, message)\n\n        return new Promise((resolve, reject) => {\n            ambireSDK.onMsgSigned((data: any) => {\n                return resolve(data.signature)\n            })\n\n            ambireSDK.onMsgRejected(() => {\n                reject({ code: 4001, message: 'User rejected the request.' })\n            })\n        })\n    }\n\n    const handleSignTransaction = async (transactionObject: TransactionObject) => {\n        const txTo: string = transactionObject.to.toString()\n        const txValue: string = transactionObject.value ? transactionObject.value.toString() : '0x'\n        const txData: string = transactionObject.data ? transactionObject.data.toString() : '0x'\n\n        ambireSDK.openSendTransaction(txTo, txValue, txData)\n\n        return new Promise((resolve, reject) => {\n            ambireSDK.onTxnSent((data: any) => {\n                return resolve(data.hash)\n            })\n\n            ambireSDK.onTxnRejected(() => {\n                reject({ code: 4001, message: 'User rejected the request.' })\n            })\n        })\n    }\n\n    return () => {\n        return {\n            label: 'Ambire Wallet',\n            getIcon: async () => AmbireLogoSVG.default,\n            getInterface: async ({ EventEmitter }) => {\n                const emitter = new EventEmitter()\n\n                const requestPatch: any = {\n                    eth_requestAccounts: async () => {\n                        if (connectedAccounts.length > 0) {\n                            return Promise.resolve(connectedAccounts)\n                        }\n\n                        return handleLogin()\n                    },\n                    eth_selectAccounts: async () => {\n                        if (connectedAccounts.length > 0) {\n                            return Promise.resolve(connectedAccounts)\n                        }\n\n                        return handleLogin()\n                    },\n                    eth_accounts: async () => {\n                        return Promise.resolve(connectedAccounts)\n                    },\n                    eth_chainId: async () => {\n                        return Promise.resolve(connectedchain)\n                    },\n                    // @ts-ignore\n                    personal_sign: async ({ params: [message, address] }) => {\n                        return handleSignMessage('personal_sign', message)\n                    },\n                    // @ts-ignore\n                    eth_sign: async ({ params: [address, message] }) => {\n                        return handleSignMessage('eth_sign', message)\n                    },\n                    // @ts-ignore\n                    eth_signTypedData: async ({ params: [address, typedData] }) => {\n                        return handleSignMessage('eth_signTypedData', typedData)\n                    },\n                    // @ts-ignore\n                    eth_signTypedData_v4: async ({ params: [address, typedData] }) => {\n                        return handleSignMessage('eth_signTypedData_v4', typedData)\n                    },\n                    // @ts-ignore\n                    eth_sendTransaction: async ({ params: [transactionObject] }) => {\n                        const txTo: string = transactionObject.to.toString()\n                        const txValue: string = transactionObject.value.toString()\n                        const txData: string = transactionObject.data ? transactionObject.data.toString() : '0x'\n\n                        ambireSDK.openSendTransaction(txTo, txValue, txData)\n\n                        return new Promise((resolve, reject) => {\n                            ambireSDK.onTxnSent((data: any) => {\n                                return resolve(data.hash)\n                            })\n\n                            ambireSDK.onTxnRejected(() => {\n                                reject({ code: 4001, message: 'User rejected the request.' })\n                            })\n                        })\n                    },\n                    // @ts-ignore\n                    eth_sendTransaction: async ({ params: [transactionObject] }) => {\n                        return handleSignTransaction(transactionObject)\n                    },\n                    // @ts-ignore\n                    eth_signTransaction: async ({ params: [transactionObject] }) => {\n                        return handleSignTransaction(transactionObject)\n                    },\n                    // @ts-ignore\n                    wallet_switchEthereumChain: async ({ params: [chainObject] }) => {\n                        return handleLogin(chainObject.chainId)\n                    },\n                }\n\n                const provider = createEIP1193Provider({\n                    on: emitter.on.bind(emitter),\n                    disconnect: () => {\n                        ambireSDK.openLogout()                      \n                        ambireSDK.onLogoutSuccess(() => {\n                            connectedAccounts = []\n                        })\n                    }\n                }, requestPatch)\n\n                return {\n                    provider\n                }\n            },\n            platforms: ['all']\n        }\n    }\n}\n"],"names":["AmbireWalletModule","sdkParams","ambireSDK","AmbireLoginSDK","connectedAccounts","connectedchain","handleLogin","chainId","openLogin","parseInt","Promise","resolve","reject","onLoginSuccess","data","address","toString","onAlreadyLoggedIn","onRegistrationSuccess","onActionRejected","code","message","handleSignMessage","signType","openSignMessage","onMsgSigned","signature","onMsgRejected","handleSignTransaction","transactionObject","txTo","to","txValue","value","txData","openSendTransaction","onTxnSent","hash","onTxnRejected","label","getIcon","AmbireLogoSVG","default","getInterface","EventEmitter","emitter","requestPatch","eth_requestAccounts","length","eth_selectAccounts","eth_accounts","eth_chainId","personal_sign","params","eth_sign","eth_signTypedData","typedData","eth_signTypedData_v4","eth_sendTransaction","eth_signTransaction","wallet_switchEthereumChain","chainObject","provider","createEIP1193Provider","on","bind","disconnect","openLogout","onLogoutSuccess","platforms"],"mappings":"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"}