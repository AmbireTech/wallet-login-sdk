"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@ethersproject/providers"),t=require("@ambire/login-sdk-core"),s=require("@web3-react/types");function n(e,t,s,n,r,i,o){try{var a=e[i](o),d=a.value}catch(e){return void s(e)}a.done?t(d):Promise.resolve(d).then(n,r)}function r(e){return function(){var t=this,s=arguments;return new Promise((function(r,i){var o=e.apply(t,s);function a(e){n(o,r,i,a,d,"next",e)}function d(e){n(o,r,i,a,d,"throw",e)}a(void 0)}))}}class i extends e.JsonRpcProvider{constructor(e,t,s,n){super(s,n),this._address=t,this._sdk=e}getSigner(e){var t=super.getSigner(e||this._address),s=this,n={get:(e,i,o)=>"sendTransaction"===i&&e[i]instanceof Function?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.data?t:t[0],o=i.value?i.value.toString():"0";return s._sdk.openSendTransaction(i.to,o,i.data),new Promise((e,t)=>{s._sdk.onTxnSent(function(){var t=r((function*(t){for(var n=t.hash,r=null,o=0;null===r&&o<5;)null===(r=yield s.getTransaction(n))&&(yield new Promise(e=>setTimeout(e,1500)),o++);var a=s._wrapTransaction(r,n);return a.data=i.data,e(a)}));return function(e){return t.apply(this,arguments)}}()),s._sdk.onTxnRejected(()=>{t({code:4001})})})}:"connectUnchecked"===i&&e[i]instanceof Function?function(){return new Proxy(t,n)}:("signMessage"===i||"_legacySignMessage"===i||"_signTypedData"===i)&&e[i]instanceof Function?function(){for(var e="signMessage"===i?"personal_sign":"_legacySignMessage"===i?"eth_sign":"eth_signTypedData_v4",t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return s.handleMsgSign(e,n)}:Reflect.get(e,i,o)};return new Proxy(t,n)}handleMsgSign(e,t){return this._sdk.openSignMessage(e,1===t.length?t[0]:t),new Promise((e,s)=>{this._sdk.msgSigned(()=>e(t[0])),this._sdk.onMsgRejected(()=>{s({code:4001})})})}}exports.AmbireConnector=class extends s.Connector{constructor(e,s,n){super(e,n),this._sdk=new t.AmbireLoginSDK(s)}activate(e){return this.actions.startActivation(),this._sdk.openLogin(e),new Promise((t,s)=>{this._sdk.onAlreadyLoggedIn(s=>{var n=e?parseInt(e.chainId):parseInt(s.chainId);this.customProvider=this.getProvider(s.address,s.providerUrl),this.actions.update({chainId:n,accounts:[s.address]}),t()}),this._sdk.onLoginSuccess(s=>{var n=e?parseInt(e.chainId):parseInt(s.chainId);this.customProvider=this.getProvider(s.address,s.providerUrl),this.actions.update({chainId:n,accounts:[s.address]}),t()}),this._sdk.onRegistrationSuccess(s=>{var n=e?e.chainId:s.chainId;this.customProvider=this.getProvider(s.address,s.providerUrl),this.actions.update({chainId:n,accounts:[s.address]}),t()}),this._sdk.onActionRejected(e=>{var t=parseInt(e.chainId);this.customProvider=this.getProvider(e.address,e.providerUrl),this.actions.update({chainId:t,accounts:[e.address]}),s({code:4001,message:"User rejected the request."})})})}deactivate(){return this._sdk.openLogout(),new Promise(e=>{this._sdk.onLogoutSuccess(()=>{this.customProvider=null,this.actions.resetState(),e()})})}getProvider(e,t){return new i(this._sdk,e,t)}},exports.AmbireProvider=i;
//# sourceMappingURL=login-sdk-web3-react.cjs.production.min.js.map
