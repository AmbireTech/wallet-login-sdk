"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@ethersproject/providers"),t=require("@ambire/login-sdk-core"),n=require("@web3-react/types"),r=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,s=this.s;if(s){var o=1&s?t:n;if(o){try{i(r,1,o(this.v))}catch(e){i(r,2,e)}return r}return this}return this.o=function(e){try{var s=e.v;1&e.s?i(r,1,t?t(s):s):n?i(r,1,n(s)):i(r,2,s)}catch(e){i(r,2,e)}},r},e}();function i(e,t,n){if(!e.s){if(n instanceof r){if(!n.s)return void(n.o=i.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(i.bind(null,e,t),i.bind(null,e,2));e.s=t,e.v=n;var s=e.o;s&&s(e)}}function s(e){return e instanceof r&&1&e.s}function o(e,t,n){for(var o;;){var a=e();if(s(a)&&(a=a.v),!a)return d;if(a.then){o=0;break}var d=n();if(d&&d.then){if(!s(d)){o=1;break}d=d.s}if(t){var c=t();if(c&&c.then&&!s(c)){o=2;break}}}var u=new r,h=i.bind(null,u,2);return(0===o?a.then(f):1===o?d.then(v):c.then(l)).then(void 0,h),u;function v(r){d=r;do{if(t&&(c=t())&&c.then&&!s(c))return void c.then(l).then(void 0,h);if(!(a=e())||s(a)&&!a.v)return void i(u,1,d);if(a.then)return void a.then(f).then(void 0,h);s(d=n())&&(d=d.v)}while(!d||!d.then);d.then(v).then(void 0,h)}function f(e){e?(d=n())&&d.then?d.then(v).then(void 0,h):v(d):i(u,1,d)}function l(){(a=e())?a.then?a.then(f).then(void 0,h):f(a):i(u,1,d)}}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));class a extends e.JsonRpcProvider{constructor(e,t,n,r){super(n,r),this._address=t,this._sdk=e}getSigner(e){var t=super.getSigner(e||this._address),n=this,r={get:(e,i,s)=>"sendTransaction"===i&&e[i]instanceof Function?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t.data?t:t[0],s=i.value?i.value.toString():"0";return n._sdk.openSendTransaction(i.to,s,i.data),new Promise((e,t)=>{n._sdk.onTxnSent((function(t){try{function r(){var t=n._wrapTransaction(a,s);return t.data=i.data,e(t)}var s=t.hash,a=null,d=0,c=o((function(){return null===a&&d<5}),void 0,(function(){return Promise.resolve(n.getTransaction(s)).then((function(e){a=e;var t=function(){if(null===a)return Promise.resolve(new Promise(e=>setTimeout(e,1500))).then((function(){d++}))}();if(t&&t.then)return t.then((function(){}))}))}));return Promise.resolve(c&&c.then?c.then(r):r())}catch(e){return Promise.reject(e)}})),n._sdk.onTxnRejected(()=>{t({code:4001})})})}:"connectUnchecked"===i&&e[i]instanceof Function?function(){return new Proxy(t,r)}:("signMessage"===i||"_legacySignMessage"===i||"_signTypedData"===i)&&e[i]instanceof Function?function(){for(var e="signMessage"===i?"personal_sign":"_legacySignMessage"===i?"eth_sign":"eth_signTypedData_v4",t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return n.handleMsgSign(e,r)}:Reflect.get(e,i,s)};return new Proxy(t,r)}handleMsgSign(e,t){return this._sdk.openSignMessage(e,1===t.length?t[0]:t),new Promise((e,n)=>{this._sdk.msgSigned(()=>e(t[0])),this._sdk.onMsgRejected(()=>{n({code:4001})})})}}exports.AmbireConnector=class extends n.Connector{constructor(e,n,r){super(e,r),this._sdk=new t.AmbireLoginSDK(n)}activate(e){return this.actions.startActivation(),this._sdk.openLogin(e),new Promise((t,n)=>{this._sdk.onAlreadyLoggedIn(n=>{var r=e?parseInt(e.chainId):parseInt(n.chainId);this.customProvider=this.getProvider(n.address,n.providerUrl),this.actions.update({chainId:r,accounts:[n.address]}),t()}),this._sdk.onLoginSuccess(n=>{var r=e?parseInt(e.chainId):parseInt(n.chainId);this.customProvider=this.getProvider(n.address,n.providerUrl),this.actions.update({chainId:r,accounts:[n.address]}),t()}),this._sdk.onRegistrationSuccess(n=>{var r=e?e.chainId:n.chainId;this.customProvider=this.getProvider(n.address,n.providerUrl),this.actions.update({chainId:r,accounts:[n.address]}),t()}),this._sdk.onActionRejected(e=>{var t=parseInt(e.chainId);this.customProvider=this.getProvider(e.address,e.providerUrl),this.actions.update({chainId:t,accounts:[e.address]}),n({code:4001,message:"User rejected the request."})})})}deactivate(){return this._sdk.openLogout(),new Promise(e=>{this._sdk.onLogoutSuccess(()=>{this.customProvider=null,this.actions.resetState(),e()})})}getProvider(e,t){return new a(this._sdk,e,t)}},exports.AmbireProvider=a;
//# sourceMappingURL=login-sdk-web3-react.cjs.production.min.js.map
