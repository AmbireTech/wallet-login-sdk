"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@web3-react/types"),n=require("@ethersproject/providers");function t(e,n,t,s,r,i,a){try{var o=e[i](a),d=o.value}catch(e){return void t(e)}o.done?n(d):Promise.resolve(d).then(s,r)}function s(e){return function(){var n=this,s=arguments;return new Promise((function(r,i){var a=e.apply(n,s);function o(e){t(a,r,i,o,d,"next",e)}function d(e){t(a,r,i,o,d,"throw",e)}o(void 0)}))}}class r extends n.JsonRpcProvider{constructor(e,n,t,s){super(t,s),this._address=n,this._sdk=e}getSigner(e){var n=super.getSigner(e||this._address),t=this,r={get:(e,i,a)=>"sendTransaction"===i&&e[i]instanceof Function?function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=r.data?r:r[0];return t._sdk.openSendTransaction(a.to,null!=(e=a.value)?e:"0",a.data),new Promise((e,n)=>{t._sdk.onTxnSent(function(){var n=s((function*(n){var s=n.hash,r=yield t.getTransaction(s),i=t._wrapTransaction(r,s);return i.data=a.data,e(i)}));return function(e){return n.apply(this,arguments)}}()),t._sdk.onTxnRejected(()=>{n({code:4001})})})}:"connectUnchecked"===i&&e[i]instanceof Function?function(){return new Proxy(n,r)}:("signMessage"===i||"_legacySignMessage"===i||"_signTypedData"===i)&&e[i]instanceof Function?function(){for(var e="signMessage"===i?"personal_sign":"_legacySignMessage"===i?"eth_sign":"eth_signTypedData_v4",n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return t.handleMsgSign(e,s)}:Reflect.get(e,i,a)};return new Proxy(n,r)}handleMsgSign(e,n){return this._sdk.openSignMessage(e,1===n.length?n[0]:n),new Promise((e,t)=>{this._sdk.msgSigned(()=>e(n[0])),this._sdk.onMsgRejected(()=>{t({code:4001})})})}}exports.AmbireWallet=class extends e.Connector{constructor(e,n,t){super(e,t),this._sdk=new window.AmbireSDK(n)}activate(e){return this.actions.startActivation(),this._sdk.openLogin(e),new Promise(n=>{this._sdk.onAlreadyLoggedIn(t=>{var s=e?parseInt(e.chainId):parseInt(t.chainId);this.customProvider=this.getProvider(t.address,t.providerUrl),this.actions.update({chainId:s,accounts:[t.address]}),n()}),this._sdk.onLoginSuccess(t=>{var s=e?parseInt(e.chainId):parseInt(t.chainId);this.customProvider=this.getProvider(t.address,t.providerUrl),this.actions.update({chainId:s,accounts:[t.address]}),n()}),this._sdk.onRegistrationSuccess(t=>{var s=e?e.chainId:t.chainId;this.customProvider=this.getProvider(t.address,t.providerUrl),this.actions.update({chainId:s,accounts:[t.address]}),n()})})}deactivate(){return this._sdk.openLogout(),new Promise(e=>{this._sdk.onLogoutSuccess(()=>{this.customProvider=null,this.actions.resetState(),e()})})}getProvider(e,n){return new r(this._sdk,e,n)}};
//# sourceMappingURL=ambire-login-sdk.cjs.production.min.js.map
