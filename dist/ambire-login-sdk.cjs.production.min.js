"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@web3-react/types"),t=require("@ethersproject/providers");function s(e,t,s,n,r,i,a){try{var o=e[i](a),d=o.value}catch(e){return void s(e)}o.done?t(d):Promise.resolve(d).then(n,r)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){s(a,r,i,o,d,"next",e)}function d(e){s(a,r,i,o,d,"throw",e)}o(void 0)}))}}class r extends t.JsonRpcProvider{constructor(e,t,s,n){super(s,n),this._address=t,this._sdk=e}getSigner(e){var t=super.getSigner(e||this._address),s=this,r={get:(e,i,a)=>"sendTransaction"===i&&e[i]instanceof Function?function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var a=r.data?r:r[0];return s._sdk.openSendTransaction(a.to,null!=(e=a.value)?e:"0",a.data),new Promise((e,t)=>{s._sdk.onTxnSent(function(){var t=n((function*(t){var n=t.hash,r=yield s.getTransaction(n),i=s._wrapTransaction(r,n);return i.data=a.data,e(i)}));return function(e){return t.apply(this,arguments)}}()),s._sdk.onTxnRejected(()=>{t({code:4001})})})}:"connectUnchecked"===i&&e[i]instanceof Function?function(){return new Proxy(t,r)}:("signMessage"===i||"_legacySignMessage"===i||"_signTypedData"===i)&&e[i]instanceof Function?function(){for(var e="signMessage"===i?"personal_sign":"_legacySignMessage"===i?"eth_sign":"eth_signTypedData_v4",t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return s.handleMsgSign(e,n)}:Reflect.get(e,i,a)};return new Proxy(t,r)}handleMsgSign(e,t){return this._sdk.openSignMessage(e,1===t.length?t[0]:t),new Promise((e,s)=>{this._sdk.msgSigned(()=>e(t[0])),this._sdk.onMsgRejected(()=>{s({code:4001})})})}}exports.AmbireWallet=class extends e.Connector{constructor(e,t,s){super(e,s),this._sdk=new window.AmbireSDK(t)}activate(e){return this.actions.startActivation(),this._sdk.openLogin(e),new Promise((t,s)=>{this._sdk.onAlreadyLoggedIn(s=>{var n=e?parseInt(e.chainId):parseInt(s.chainId);this.customProvider=this.getProvider(s.address,s.providerUrl),this.actions.update({chainId:n,accounts:[s.address]}),t()}),this._sdk.onLoginSuccess(s=>{var n=e?parseInt(e.chainId):parseInt(s.chainId);this.customProvider=this.getProvider(s.address,s.providerUrl),this.actions.update({chainId:n,accounts:[s.address]}),t()}),this._sdk.onRegistrationSuccess(s=>{var n=e?e.chainId:s.chainId;this.customProvider=this.getProvider(s.address,s.providerUrl),this.actions.update({chainId:n,accounts:[s.address]}),t()}),this._sdk.onActionRejected(e=>{var t=parseInt(e.chainId);this.customProvider=this.getProvider(e.address,e.providerUrl),this.actions.update({chainId:t,accounts:[e.address]}),s({code:4001,message:"User rejected the request."})})})}deactivate(){return this._sdk.openLogout(),new Promise(e=>{this._sdk.onLogoutSuccess(()=>{this.customProvider=null,this.actions.resetState(),e()})})}getProvider(e,t){return new r(this._sdk,e,t)}};
//# sourceMappingURL=ambire-login-sdk.cjs.production.min.js.map
