"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@web3-react/types"),t=require("@ethersproject/bignumber"),s=require("@ethersproject/providers");function n(e,t,s,n,r,i,a){try{var o=e[i](a),d=o.value}catch(e){return void s(e)}o.done?t(d):Promise.resolve(d).then(n,r)}function r(e){return function(){var t=this,s=arguments;return new Promise((function(r,i){var a=e.apply(t,s);function o(e){n(a,r,i,o,d,"next",e)}function d(e){n(a,r,i,o,d,"throw",e)}o(void 0)}))}}class i extends s.JsonRpcProvider{constructor(e,t,s,n){super(s,n),this._address=t,this._sdk=e}getSigner(e){var s=super.getSigner(e||this._address),n=this,i={get:(e,a,o)=>"sendTransaction"===a&&e[a]instanceof Function?function(){for(var e=arguments.length,s=new Array(e),i=0;i<e;i++)s[i]=arguments[i];var a=s.data?s:s[0],o=a.value?a.value instanceof t.BigNumber?a.value.toString():a.value:"0";return n._sdk.openSendTransaction(a.to,o,a.data),new Promise((e,t)=>{n._sdk.onTxnSent(function(){var t=r((function*(t){var s=t.hash,r=yield n.getTransaction(s),i=n._wrapTransaction(r,s);return i.data=a.data,e(i)}));return function(e){return t.apply(this,arguments)}}()),n._sdk.onTxnRejected(()=>{t({code:4001})})})}:"connectUnchecked"===a&&e[a]instanceof Function?function(){return new Proxy(s,i)}:("signMessage"===a||"_legacySignMessage"===a||"_signTypedData"===a)&&e[a]instanceof Function?function(){for(var e="signMessage"===a?"personal_sign":"_legacySignMessage"===a?"eth_sign":"eth_signTypedData_v4",t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return n.handleMsgSign(e,s)}:Reflect.get(e,a,o)};return new Proxy(s,i)}handleMsgSign(e,t){return this._sdk.openSignMessage(e,1===t.length?t[0]:t),new Promise((e,s)=>{this._sdk.msgSigned(()=>e(t[0])),this._sdk.onMsgRejected(()=>{s({code:4001})})})}}exports.AmbireWallet=class extends e.Connector{constructor(e,t,s){super(e,s),this._sdk=new window.AmbireSDK(t)}activate(e){return this.actions.startActivation(),this._sdk.openLogin(e),new Promise((t,s)=>{this._sdk.onAlreadyLoggedIn(s=>{var n=e?parseInt(e.chainId):parseInt(s.chainId);this.customProvider=this.getProvider(s.address,s.providerUrl),this.actions.update({chainId:n,accounts:[s.address]}),t()}),this._sdk.onLoginSuccess(s=>{var n=e?parseInt(e.chainId):parseInt(s.chainId);this.customProvider=this.getProvider(s.address,s.providerUrl),this.actions.update({chainId:n,accounts:[s.address]}),t()}),this._sdk.onRegistrationSuccess(s=>{var n=e?e.chainId:s.chainId;this.customProvider=this.getProvider(s.address,s.providerUrl),this.actions.update({chainId:n,accounts:[s.address]}),t()}),this._sdk.onActionRejected(e=>{var t=parseInt(e.chainId);this.customProvider=this.getProvider(e.address,e.providerUrl),this.actions.update({chainId:t,accounts:[e.address]}),s({code:4001,message:"User rejected the request."})})})}deactivate(){return this._sdk.openLogout(),new Promise(e=>{this._sdk.onLogoutSuccess(()=>{this.customProvider=null,this.actions.resetState(),e()})})}getProvider(e,t){return new i(this._sdk,e,t)}};
//# sourceMappingURL=ambire-login-sdk.cjs.production.min.js.map
